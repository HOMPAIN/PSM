# 6 Настройка ограничений
**Внимание! Для прошивки ниже v3.200 максимальный фазный и батарейный ток 50А. Для тока 70А необходимо обновить прошивку на последнюю версию.**

Контроллер PSM позволяет настроить ряд ограничений тока и напряжения:
-  ограничение фазного тока на разгоне и при торможении,
-  ограничение тока питания (тока потребления и рекуперации),
-  ограничение минимального и максимального напряжения батареи.

Все ограничения задаются целым числом в миллиАмпирах и миллиВольтах. Подробный процесс настройки описан в разделе [Настройка](9-nastroyka-kontrollera).
## Ограничение фазного тока
Ограничение фазного тока задаёт максимальный момент двигателя, его тягу.
Фазный ток - это ток, который течёт в цепи между контроллером и мотором. В момент старта двигателя фазный ток в несколько раз превышает ток батареи, а по мере разгона двигателя фазный ток и батарейный выравниваются.
### Ограничение фазного тока на разгоне
Ограничение фазного тока на разгоне позволяет решить ряд проблем:
- ограничить ток и нагрев двигателя,
- ограничить пробуксовку переднего колеса.

Для ограничения фазного тока разгона используется команда `curr_phase_max_forward` или `cpmf`. 
Пример команды для ограничения 25А:
`curr_phase_max_forward 25000`
Допустимый диапазон ограничений фазного тока разгона для PSM 5-70А.
_Если установить ограничение 0 или слишком большое значение, тогда будет срабатывать глобальное ограничение фазного тока. Не рекомендуется так делать, данный режим работы считается аварийным._
### Ограничение фазного тока на торможении
Ограничение фазного тока на торможении решают следующие задачи:
- сделать торможение более плавным приятным,
- ограничить ток и нагрев двигателя,
- выключить торможение двигателем, если оно не нужно.

Для ограничения фазного тока торможения используется команда `curr_phase_max_revers`  или `cpmr`. 
Пример команды для ограничения 15А:
`curr_phase_max_revers 15000`
Допустимый диапазон фазного тока для торможения двигателем 2.5-70А, рекомендуемый 5-25А. 
Для отключения торможения двигателем необходимо выбрать режим управления ручкой газа без торможения, при этом любое значение ограничения фазного тока торможения будет игнорироваться.
_Если установить ограничение 0 или слишком большое значение, тогда будет срабатывать глобальное ограничение фазного тока. Не рекомендуется так делать, данный режим считается аварийным._
## Ограничения тока питания
Ограничения тока питания задают ток в цепи между батареей и контроллером. Отдельно можно ограничить ток потребления и ток рекуперации.
Ток питания - батарейный ток всегда меньше фазного и сравнивается, когда мотор выходит на свои максимальные обороты при текущем уровне тяги.

Ограничения тока питания решает следующие задачи:
- защита батареи от слишком большого тока,
- предотвращение срабатывание защиты БМС батареи,
- ограничение мощности двигателя.

Для ограничения тока питания используется команда `curr_max`. 
Пример команды для ограничения 15А:
`curr_max 15000`

Для ограничения тока рекуперации используется команда `curr_max_recovery`. 
Пример команды для ограничения 5А:
`curr_max_recovery 5000`
Большие токи рекуперации наносят вред батареи, я рекомендую не ставить ток рекуперации больше половины от ёмкости АКБ а Ач.
Для выключения рекуперации нужно установить маленькое, но не нулевое значение, например:
`curr_max_recovery 100`

Для тока питания и рекуперации допускается значение 0, в данном случаи ток не будет ограничиваться.

## Ограничение напряжения батареи
В контроллере можно выставить ограничение минимального и максимального напряжения.

Ограничение минимального напряжения выставляется для ограничения мощности двигателя при разряженной батареи, что бы БМС её не отрубала из-за скачков тока.
Ограничение максимального напряжения предотвращает отключение батареи при рекуперации и защищает её от скачка напряжения при отключении батареи.

Для установки минимального напряжения используется команда `v_min `, для максимального `v_max ` . 
Пример установки установки ограничения минимума на 41В и максимума 55.4В:
`v_min 41000`
`v_max 55400`

Для минимума напряжения допускается установка нулевого значения, для его отключения.
Для максимального значения напряжения ставить нулевое значение и тут самым отключать защиту не стоит. Если ограничение не нужно установите его на пару воль выше максимума для батареи, в противном случаи напряжение может скакнуть до 85В при сбросе газа.

Контроллер измеряет напряжение с невысокой точностью, если при установленном ограничении защита АКБ срабатывает сдвиньте порог на 1-2В.