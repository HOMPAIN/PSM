# 5 Настройка ручки газа
Настройка ручки газа состоит из 2х этапов: калибровка рабочего хода, выбор режима управления.

## Калибровка рабочего хода
Для калибровки рабочего хода необходимо ввести команду `calib_trot`, затем выжать ручку газа до упора и отпустить. В ответ придёт рабочий диапазон ручки газа.

## Выбор режима управления
Вторым этапом нужно выбрать режим управления: 
- управление моментом без торможения,
- адаптивный режим с торможением,
- адаптивный режим без торможения,
- управление моментом с торможением.

Данную настройку удобно проводить на улице через телефон, что бы сразу тестировать работу ручки газа и выбрать удобный вариант по ощущениям.

**Управление моментом (без торможения)** `control_mode 4`
Рекомендуется для редукторных моторов или моторов с цепным приводом, на которых торможение двигателем невозможно. 
В данном режиме контроллер будет подавать фазный ток на двигатель пропорционально нажатию на ручку газа.
Для выбора режима управления моментом необходимо ввести команду `control_mode 4`. 

**Адаптивный режим с торможением** `control_mode 3`.
Хорошо подходит для моторов прямого привода. 
Он обеспечивает плавное торможение двигателем при сбросе газа и в данном режиме проще поддерживать постоянную скорость. В этом режиме работа ручки газа похожа на работу педали газа в автомобиле.
Для выбора адаптивного режима управления необходимо ввести команду `control_mode 3`.  

Адаптивный режим нельзя использовать на двухмоторном транспорте, если моторы разные. При разных моторах будет возможна ситуация, когда один мотор будет тормозить, а второй газовать.

**Адаптивный режим (без торможения)** `control_mode 5`.
Рекомендуется для редукторных моторов или моторов с цепным приводом, на которых торможение двигателем невозможно.
В отличии от режима управления моментом данный режим позволяет более точно поддерживать постоянную скорость и не даёт мотору неконтролируемо разгоняться при срыве. 
Данный режим удобен для движения на низкой скорости, подъёмах транспорта по пандусам, езды по скользким поверхностям.
Для выбора адаптивного режима управления необходимо ввести команду `control_mode 5`.  

Адаптивный режим нельзя использовать на двухмоторном транспорте, если моторы разные. При разных моторах будет возможна ситуация, когда один мотор будет тормозить, а второй газовать.

**Управление моментом с торможением** `control_mode 2`
В данном режиме контроллер будет подавать фазный ток на двигатель в диапазоне от минимального (фазный ток торможения) до максимального. Данный режим удобен, когда требуется небольшое торможение и фазный ток торможения в пределах 20% от тока разгона, либо когда контроллер **PSM** управляется другим устройством, требующим точное задание момента.
Для выбора режима управления моментом необходимо ввести команду `control_mode 2`.  

### Плавность ручки газа и диапазон работы
В обоих режимах ручка газа управляет фазным током двигателя. Ограничения фазного тока влияют на диапазон и плавность работы ручки газа. Подробно про задание ограничений описано в соответствующем [разделе](6-nastroyka-ogranicheniy-toka).
Команды ограничений фазного тока:
`curr_phase_max_forward 25000` - для задания фазного тока на разгоне в мА,
`curr_phase_max_revers 15000` - для задания фазного тока торможения в мА. 